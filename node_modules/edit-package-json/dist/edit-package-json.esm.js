/**
 * @name edit-package-json
 * @fileoverview Edit package.json without parsing, as string, to keep the formatting intact
 * @version 0.7.2
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/edit-package-json/}
 */

import{left as V,right as j,chompLeft as U}from"string-left-right";import{rApply as J}from"ranges-apply";var W="0.7.2";var Q=W;function O(e){return typeof e=="string"}function v(e){return Array.isArray(e)?e.join("."):O(e)?e:String(e)}function F(e){return O(e)&&e.startsWith('"')&&e.endsWith('"')?`${JSON.stringify(e.slice(1,e.length-1),null,0)}`:JSON.stringify(e,null,0)}function f(e,y){if(e[y]!=="\\")return!0;let p=U(e,y,{mode:1},"\\");return typeof p=="number"&&(y-p)%2!==0}function I({str:e,path:y,valToInsert:p,mode:N}){let n=0;function t(s){e[n]}let x=e.length,P=[];t(`077 main(): MODE=${N}`);let w=["{","}","[","]",":",","],D=p;O(p)&&!p.startsWith('"')&&!p.startsWith("{")&&(D=`"${p}"`);let b=[],o=[],h=!1,l=!1,r=!1,c=null,E=null,u=null,d=null,S=null,T=null,i;function k(){return typeof i=="number"}let a=!1,m=[];function A(){c=null,E=null,u=null,d=null,S=null,T=null}A();let $=[];for(n=0;n<x;n++){if(t(`
\x1B[${36}m===============================\x1B[${39}m \x1B[${35}m${`str[ ${n} ] = ${e[n]?.trim()?e[n]:JSON.stringify(e[n],null,0)}`}\x1B[${39}m \x1B[${36}m===============================\x1B[${39}m
`),typeof i!="number"&&e[n-1]==="["&&(l=!0,e[n]!=="]"&&(h=!1)),typeof i!="number"&&e[n-1]==="{"&&(h=!0,e[n]!=="}"&&(l=!1)),typeof i!="number"&&e[n]==="{"&&f(e,n-1)&&!r&&(l&&(a||(t(`198 ${`\x1B[${33}mcurrentPath\x1B[${39}m`} = ${JSON.stringify($,null,4)}`),$[$.length-1]=$[$.length-1]+1,t(`207 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}m${`currentPath[${$.length-1}]`}\x1B[${39}m`} = ${$[$.length-1]}`))),b.push(n),t(`215 ${`\x1B[${32}mPUSH\x1B[${39}m`} ${`\x1B[${33}mwithinObjectIndexes\x1B[${39}m`} = ${JSON.stringify(b,null,4)}`)),typeof i!="number"&&e[n]==="}"&&f(e,n-1)&&!r&&(b.pop(),t(`231 ${`\x1B[${31}mPOP\x1B[${39}m`} ${`\x1B[${33}mwithinObjectIndexes\x1B[${39}m`} = ${JSON.stringify(b,null,4)}`)),typeof i!="number"&&e[n]==="]"&&f(e,n-1)&&!r&&(o.pop(),t(`248 ${`\x1B[${32}mPOP\x1B[${39}m`} ${`\x1B[${33}mwithinArrayIndexes\x1B[${39}m`} = ${JSON.stringify(o,null,4)}`),$.pop(),t(`256 POP path, now = ${JSON.stringify($,null,4)}`),t(`258 ${`\x1B[${31}mRESET\x1B[${39}m`}`),A(),a&&(a=!1,t(`267 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mitsTheFirstElem\x1B[${39}m`} = ${a}`))),typeof i!="number"&&e[n]==="]"&&(o.length?o.length&&(!b.length||o[o.length-1]>b[b.length-1])&&(l=!0):(l=!1,b.length&&!h&&(h=!0))),typeof i!="number"&&e[n]==="}"&&(b.length?(!o.length||b[b.length-1]>o[o.length-1])&&(h=!0):h=!1),l&&v(y)===$.join(".")&&!r&&e[n].trim()&&(r=!0,t(`329 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mreplaceThisValue\x1B[${39}m`} = ${r}`),u=n,t(`334 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mvalueStartedAt\x1B[${39}m`} = ${u}`)),typeof i!="number"&&e[n]==="["&&f(e,n-1)&&!r&&(o.push(n),a=!0,t(`348 ${`\x1B[${32}mPUSH\x1B[${39}m`} ${`\x1B[${33}mwithinArrayIndexes\x1B[${39}m`} = ${JSON.stringify(o,null,4)}; ${`\x1B[${33}mitsTheFirstElem\x1B[${39}m`} = ${a}`),$.push(0),t(`359 ${`\x1B[${32}mPUSH\x1B[${39}m`} zero to path, now = ${JSON.stringify($,null,0)}`)),l&&e[n]===","&&a&&!(typeof u=="number"&&d===null)&&(a=!1,t(`379 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mitsTheFirstElem\x1B[${39}m`} = ${a}`)),!r&&u===null&&e[n].trim()&&!w.includes(e[n])&&(l||!l&&S!==null)&&(t("415 catching the start of a value clauses"),u=n,t(`418 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mvalueStartedAt\x1B[${39}m`} = ${u}`),l&&(a?(a=!1,t(`426 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mitsTheFirstElem\x1B[${39}m`} = ${a}`)):typeof $[$.length-1]=="number"&&($[$.length-1]=$[$.length-1]+1,t(`432 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}m${`currentPath[${$.length-1}]`}\x1B[${39}m`} = ${$[$.length-1]}`)))),!r&&typeof i!="number"&&(l||!l&&S!==null)&&typeof u=="number"&&u<n&&d===null&&(e[u]==='"'&&e[n]==='"'&&e[n-1]!=="\\"||e[u]!=='"'&&!e[n].trim()||["}",","].includes(e[n]))&&(t("451 catching the end of a value clauses"),T=e.slice(u,e[u]==='"'?n+1:n),t(`457 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mkeyValue\x1B[${39}m`} = ${T}`),d=n,t(`461 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mvalueEndedAt\x1B[${39}m`} = ${d}`)),!r&&!l&&e[n]==='"'&&e[n-1]!=="\\"&&S===null&&c===null&&E===null&&e[n+1]&&(c=n+1,t(`478 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mkeyStartedAt\x1B[${39}m`} = ${c}`)),!r&&!l&&e[n]==='"'&&e[n-1]!=="\\"&&E===null&&typeof c=="number"&&u===null&&c<n&&(E=n+1,S=e.slice(c,n),t(`501 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mkeyEndedAt\x1B[${39}m`} = ${E};  ${`\x1B[${33}mkeyName\x1B[${39}m`} = ${S}`),$.push(S),t(`506 PUSH to path, now = ${JSON.stringify($,null,4)}`),v(y)===$.join(".")&&(r=!0,t(`515 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mreplaceThisValue\x1B[${39}m`} = ${r}`))),!r&&typeof i!="number"&&e[n]===","&&h&&($.pop(),t(`535 POP(), now ${`\x1B[${33}mcurrentPath\x1B[${39}m`} = ${JSON.stringify($,null,0)}`)),!r&&(typeof d=="number"&&n>=d||["}","]"].includes(e[V(e,n)])&&["}","]"].includes(e[n])||e[n]==="}"&&e[V(e,n)]==="{")&&e[n].trim()&&(t(`552 ${`\x1B[${36}m\u2588\u2588\x1B[${39}m`} catch the end of a key-value pair clauses`),e[n]===","&&!["}","]"].includes(e[j(e,n)])?(t(`555 ${`\x1B[${31}mRESET\x1B[${39}m`}`),A()):e[n]==="}"&&(t("558 closing curlie caught"),(d||e[V(e,n)]!=="{")&&($.pop(),t(`569 POP(), now ${`\x1B[${33}mcurrentPath\x1B[${39}m`} = ${JSON.stringify($,null,0)}`)),t(`577 currently, currentlyWithinObject: ${h}`),t(`578 currently, currentlyWithinArray: ${l}`),o.length&&b.length&&o[o.length-1]>b[b.length-1]&&(h=!1,l=!0),t(`616 ${`\x1B[${31}mRESET\x1B[${39}m`}`),A())),!r&&e[n]==="{"&&O(S)&&u===null&&T===null&&(t(`630 ${`\x1B[${31}mRESET\x1B[${39}m`}`),A()),e[n].trim()&&r&&u===null&&typeof E=="number"&&n>E&&![":"].includes(e[n])&&(u=n,t(`644 ${`\x1B[${32}mSET\x1B[${39}m`} ${`\x1B[${33}mvalueStartedAt\x1B[${39}m`} = ${u}`)),e[n]==='"'&&f(e,n-1)&&(typeof c=="number"&&E===null||typeof u=="number"&&d===null)&&typeof i!="number"&&(i=n,t(`658 SET ${`\x1B[${33}mwithinQuotesSince\x1B[${39}m`} = ${i}; withinQuotes = ${k()}`)),m.length&&e[n]===m[m.length-1]&&f(e,n-1)?(m.pop(),t(`677 ${`\x1B[${32}mPOP\x1B[${39}m`} skipUntilTheFollowingIsMet = ${JSON.stringify(m,null,4)}`)):(typeof i!="number"||i===n)&&r&&!l&&typeof u=="number"&&(e[n]==="{"&&f(e,n-1)?(m.push("}"),t(`695 ${`\x1B[${32}mPUSH\x1B[${39}m`} ${`\x1B[${33}mskipUntilTheFollowingIsMet\x1B[${39}m`} = ${JSON.stringify(m,null,4)}`)):e[n]==="["&&f(e,n-1)?(m.push("]"),t(`705 ${`\x1B[${32}mPUSH\x1B[${39}m`} ${`\x1B[${33}mskipUntilTheFollowingIsMet\x1B[${39}m`} = ${JSON.stringify(m,null,4)}`)):e[n]==='"'&&f(e,n-1)&&(m.push('"'),t(`715 ${`\x1B[${32}mPUSH\x1B[${39}m`} ${`\x1B[${33}mskipUntilTheFollowingIsMet\x1B[${39}m`} = ${JSON.stringify(m,null,4)}`))),e[n]==='"'&&f(e,n-1)&&typeof i=="number"&&i!==n&&(i=void 0,t(`753 RESET ${`\x1B[${33}mwithinQuotesSince\x1B[${39}m`} = ${i}; withinQuotes = ${k()}`)),r&&Array.isArray(m)&&!m.length&&typeof u=="number"&&n>u&&(t("766 within catch the end of the value when replaceThisValue is on clauses"),typeof i!="number"&&(e[u]==="["&&e[n]==="]"||e[u]==="{"&&e[n]==="}"||e[u]==='"'&&e[n]==='"'||!["[","{",'"'].includes(e[u])&&e[u].trim()&&(!e[n].trim()||w.includes(e[n])&&f(e,n-1))))){if(t(`780 INSIDE CATCH-END CLAUSES currently ${`\x1B[${33}m${`str[valueStartedAt=${u}]`}\x1B[${39}m`} = ${JSON.stringify(e[u],null,4)}`),N==="set"){t(`789 ${`\x1B[${32}mRETURN\x1B[${39}m`}`);let s="";e.slice(u,n+(e[n].trim()?1:0)).includes(`
`)&&e[n+(e[n].trim()?1:0)]!==`
`&&(s=`
`);let g=n+(e[n].trim()?1:0);return(l&&!['"',"[","{"].includes(e[u])&&e[j(e,g-1)]!=="]"||e[g-1]===","&&e[u-1]!=='"')&&(g-=1),l&&e[u-1]==='"'&&(u=u-1),`${e.slice(0,u)}${F(D)}${s}${e.slice(g)}`}if(N==="del"){t(`848 ${`\x1B[${32}mRETURN\x1B[${39}m`}`),t(`851 ${`\x1B[${33}mkeyStartedAt\x1B[${39}m`} = ${JSON.stringify(c,null,4)}; val = ${(l?u:c)-1}`);let s=V(e,(l?u:c)-1);typeof s=="number"&&s++,t(`864 ${`\x1B[${32}mSET\x1B[${39}m`} initial ${`\x1B[${33}mstartingPoint\x1B[${39}m`} = ${s}`);let g=n+(e[n].trim()?1:0);typeof s=="number"&&e[s-1]===","&&["}","]"].includes(e[j(e,g-1)])&&(s-=1,t(`873 SET ${`\x1B[${33}mstartingPoint\x1B[${39}m`} = ${s}`)),e[g]===","&&(g+=1,t(`879 SET ${`\x1B[${33}mendingPoint\x1B[${39}m`} = ${g}`)),t(`883 ${`\x1B[${33}mstartingPoint\x1B[${39}m`} = ${JSON.stringify(s,null,4)}; ${`\x1B[${33}mendingPoint\x1B[${39}m`} = ${JSON.stringify(g,null,4)};`),P.push([s,g]),t(`896 ${`\x1B[${32}mFINAL PUSH\x1B[${39}m`} ${`\x1B[${33}mranges\x1B[${39}m`} = ${JSON.stringify(P,null,4)}`),t(`902 then ${`\x1B[${31}mBREAK\x1B[${39}m`}`);break}}t(`${`\x1B[${i?32:31}m${`withinQuotesSince${typeof i=="number"?`=${i}`:""}`}\x1B[${39}m`}; ${`\x1B[${h?32:31}mcurrentlyWithinObject\x1B[${39}m`}; ${`\x1B[${l?32:31}mcurrentlyWithinArray\x1B[${39}m`}; ${`\x1B[${r?32:31}mreplaceThisValue\x1B[${39}m`}; ${`\x1B[${a?32:31}mitsTheFirstElem\x1B[${39}m`}; ${`\x1B[${m.length?32:31}m${`skipUntilTheFollowingIsMet${m?`: ${JSON.stringify(m,null,0)}`:""}`}\x1B[${39}m`}`),t(`current path: ${JSON.stringify($.join("."),null,0)}`),t(`${`\x1B[${33}mkeyName\x1B[${39}m`} = ${S}; ${`\x1B[${33}mkeyValue\x1B[${39}m`} = ${T}; ${`\x1B[${33}mkeyStartedAt\x1B[${39}m`} = ${c}; ${`\x1B[${33}mkeyEndedAt\x1B[${39}m`} = ${E}; ${`\x1B[${33}mvalueStartedAt\x1B[${39}m`} = ${u}; ${`\x1B[${33}mvalueEndedAt\x1B[${39}m`} = ${d}`),t(`${`\x1B[${33}mwithinArrayIndexes\x1B[${39}m`} = ${JSON.stringify(o,null,0)}; ${`\x1B[${33}mwithinObjectIndexes\x1B[${39}m`} = ${JSON.stringify(b,null,0)};`)}return t(`
\x1B[${36}m=============================== FIN.\x1B[${39}m`),t(`947 RETURN applied ${JSON.stringify(J(e,P),null,4)}`),J(e,P)}function L(e,y,p){if(!O(e)||!e.length)throw new Error(`edit-package-json/set(): [THROW_ID_01] first input argument must be a non-empty string. It was given as ${JSON.stringify(e,null,4)} (type ${typeof e})`);return I({str:e,path:y,valToInsert:p,mode:"set"})}function _(e,y){if(!O(e)||!e.length)throw new Error(`edit-package-json/del(): [THROW_ID_02] first input argument must be a non-empty string. It was given as ${JSON.stringify(e,null,4)} (type ${typeof e})`);return I({str:e,path:y,mode:"del"})}export{_ as del,L as set,Q as version};
